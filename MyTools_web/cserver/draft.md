# 实现思路文档

## 当前备忘

+ 登入的跳转细节需要修改。
+ 不同页面的登入认证需要再完善一下。

## 后端数据接口API

### `get->getUnites`获取不重复的的单位名

select distinct name,unitID,unitDes from unit;
这样返回到前端保存对应的单位名和ID，方便检索时使用。（虽然巴不得直接全部返回）

### `post->login` 获取用户的登入信息

select * from users U, unit T where uuid=? and U.unitID=T.unitID
返回结果会包括用户的登入信息，权限信息等，
并且返还一个token供用户保存，放在authorization请求头中方便使用。

### `get->getUserProfile`  获取用户个人资料信息顺便做用户登入权限验证

根据用户的请求头，返回用户的信息，同时也会返回一个请求状态；
如果状态为233，就说明身份验证正确。

## `get->getTargetList` 获得单位的列表

暂时感觉没必要
输入为一个uuid；返回形式为一个json，内部为一个数组，返回名称，uuid，描述。

## `post->createNewUser` 创造新的用户记录

INSERT INTO users (username,password,unitID,authority,description) VALUES ("测试",233,1,1,"测试用户")
直接对用户表内插入新对象，输入为一个json对象，含有创造用户中除了uuid以外的信息，
返回结果为用户的uuid，供用于登入使用。

## `post -> updateUser` 修改用户信息

update users set username= '饼饼',password='234',unitID='1',description='本丙' where uuid=6;
这边偷个懒，验证工作在前端完成，后端不再进行二次校验。
送出的json包含所有新的数据，其中uuid是鉴别的，不用于修改。
后端直接修改指定的信息即可。

## `get -> getUserOfCertainUnit` 获取指定单位的成员信息

get中的参数包含unit的ID，然后返回该组织的数组。
select * from users where unitID=?;

## `post -> sendSheet` 发送指定的表格对象

含有参数，创建用户ID，创建时间（算了好难），表格名称，表格信息，隶属组织，表格状态。

## `get ->sheets` 获取所有的表格对象

不需要参数，直接获取全部保存到本地。

## `post ->changeSheet` 修改该表格的状态

不需要参数，不过需要做角色权限认证。

## 用户登入验证

每次跳转路由时，先检测发送getUserProfile请求，如果请求正常响应再跳转，否则就不跳转，回到login页面。

### 目前实现进度

已经完成登录的处理。

+ 每个登入页面的验证
+ 否则跳转回登入入口
+ 登入入口的登入成功路由跳转。 

## 用户管理（创建用户）

+ 读取profile信息。
+ 如果是普通用户，则会显示缺乏权限，无法管理用户。
+ 如果是系统用户或者单位管理员用户，则会跳出新建栏，支持创建任意用户。
  + 暂时不支持创建新的单位，只可以在已有的单位选择，采用下拉框的形式，这样简单一些。
  + 如果是系统用户，则可以将之归属到任意单位。
  + 如果是单位管理员，则只可以将之归属到自己单位。
  + 信息填写完成后将信息发送到数据库插入一条新数据，用户id采用递增，id也被视为账号。

### 目前实现进度

+ 服务端需要返回一个用户账户标识给前端渲染。
+ 权限的验证机制和限制机制。
+ 初始界面为登入界面。
+ excel的导出功能。
+ excel的删除功能。
+ 单位管理的角色权限。
+ 数据呈现页面的美化（？）

## 用户管理（修改用户）

+ 根据组织搜寻。（先做这个）
+ 根据级别搜寻。
+ 检索完后渲染出一系列可供修改的参数对象
  
### 目前实现进度

+ 修改参数需要细化，需要限制一些修改权限，例如低等级不能修改高等级。
+ 非管理员不能实现修改之类的权限限制。

### 检索逻辑

`select A.username,A.uuid,A.authority,A.description,B.name,B.unitID from users A,unit B where A.unitID=B.unitID and A.authority = ?`

「一遍就能跑，赞。」
搜寻用户名，权限，描述，组织名，组织号。
这些应该够用了。
组织ID和人物ID作为修改的凭证，
但不在前端渲染出来。

前端根据这些数据进行渲染，也根据这些数据进行修改。
可以修改的内容为描述，姓名，组织，级别。

只有系统管理员和组织管理员可以修改。

### 需要做一个用户渲染兼修改组件

+ 添加按钮，该按钮可以启用该用户的信息修改操作。
+ 在启用该操作之前先检索用户的权限。
+ 该组件传入的参数为用户信息，只渲染单条用户。（配合数组使用）
+ 执行修改成功后，向后端发送修改请求。

### 修改组件的内部细节逻辑

这一部分放在单位管理模块，其中系统管理员可以查看所有单位，单位管理员和成员只能查看自己单位。
在修改之前先对权限进行检查，检查后进入以下个分支。

#### 系统管理员修改

直接修改
直接读取全部信息，将修改后的全部信息绑定。

#### 组织管理员修改

修改之前，先在前端判断其修改对象是否合法。
可以对系统管理员和组织管理员写两套修改逻辑。

1. 获取选中对象的组织ID 和 其他修改信息。
2. 如果对象的组织ID和该用户组织信息不匹配，则作废。
3. 否则照常修改，套用系统管理员接下来的逻辑（可以合并）

## 单位管理模块

### 权限预识别

如果是普通用户，则是只读；如果是系统管理员或者组织管理员，那么就渲染他们隶属组织的数据并且允许修改。

### 调取相关信息

信息包括，单位的信息和成员的信息。
其中成员的信息用上面的component渲染出来即可。
单位信息另外简单做一下。

### 信息修改接口

基本就套用component即可。
至于组织信息修改，就涉及到另外一个接口。

## 单位数据管理

这一块还没做呢，草，好难做。